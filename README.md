---

# โ README.md โ ChallengeForge Bot

> **ChallengeForge Bot** โ Telegram-ะฑะพั ะดะปั ะณะตะฝะตัะฐัะธะธ, ะณะพะปะพัะพะฒะฐะฝะธั ะธ ัะพััะฐะฝะตะฝะธั ัะตะปะปะตะฝะดะถะตะน ัะฐะทัะฐะฑะพััะธะบะพะฒ.
> ะัะฝะพะฒะฐะฝ ะฝะฐ **aiogram v3**, SQLite, ะฐัะธะฝััะพะฝะฝัั ัะตะฟะพะทะธัะพัะธัั ะธ ะฐะบะบััะฐัะฝะพะน ะฐััะธัะตะบัััะต.

---

## ๐ ะะพะทะผะพะถะฝะพััะธ

* **ะะตะฝะตัะฐัะธั ะฝะพะฒัั ัะตะปะปะตะฝะดะถะตะน** ัะตัะตะท `/challenge`
* **ะะพะปะพัะพะฒะฐะฝะธะต** ๐/๐ ะทะฐ ัะตะปะปะตะฝะดะถะธ (ะณะปะพะฑะฐะปัะฝัะน ัะตะนัะธะฝะณ)
* **ะกะพััะฐะฝะตะฝะธะต** ัะตะปะปะตะฝะดะถะตะน + ะฒะพะทะผะพะถะฝะพััั ะดะพะฑะฐะฒะธัั **ะทะฐะผะตัะบั**
* **ะะฝะปะฐะนะฝ-ัะตะถะธะผ** โ ะผะพะถะฝะพ ะดะตะปะธัััั ัะตะปะปะตะฝะดะถะฐะผะธ ะฒ ะดััะณะธะต ัะฐัั
* **ะะฐะณะธะฝะฐัะธั ัะฟะธัะบะพะฒ** `/my` ะธ `/top`
* **Rate-limit** ะดะปั ะทะฐัะธัั ะพั ัะฟะฐะผะฐ
* **FSM** (finite state machine) ะดะปั ะดะธะฐะปะพะณะฐ ยซะดะพะฑะฐะฒะธัั ะทะฐะผะตัะบั?ยป
* ะงะธัััะต ะธ ะฑะตะทะพะฟะฐัะฝัะต `callback_data`, ั HMAC-ะฟะพะดะฟะธัะฐะผะธ
* ะกัััะบัััะธัะพะฒะฐะฝะฝะฐั ะฐััะธัะตะบัััะฐ ะฟัะธะปะพะถะตะฝะธั

---

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
challengeforge-bot/
โ
โโโ app/
โ   โโโ main.py                # ะฒัะพะด ะฒ ะฟัะธะปะพะถะตะฝะธะต
โ   โโโ bot.py                 # ัะพะทะดะฐะฝะธะต Bot/Dispatcher
|   โโโ logger_config.py       # ะปะพะณะณะตั
โ   โโโ config.py              # ะบะพะฝัะธะณััะฐัะธั
โ   โ
โ   โโโ handlers/
โ   โ   โโโ base.py            # /start /help
โ   โ   โโโ challenge.py       # ะฒัั ะปะพะณะธะบะฐ ัะตะปะปะตะฝะดะถะตะน
โ   โ   โโโ inline.py          # inline-query ะพัะฒะตัั
โ   โ
โ   โโโ keyboards/
โ   โ   โโโ challenge.py       # ะบะปะฐะฒะธะฐัััั ะบะฐััะพัะตะบ
โ   โ   โโโ pagination.py      # ะบะปะฐะฒะธะฐัััะฐ ะฟะฐะณะธะฝะฐัะธะธ
โ   โ   โโโ callbacks.py       # encode/decode callback_data
โ   โ
โ   โโโ states/
โ   โ   โโโ user_state.py      # FSM: ะพะถะธะดะฐะฝะธะต ะทะฐะผะตัะบะธ
โ   โ
โ   โโโ storage/
โ   โ   โโโ db.py              # ะฟะพะดะบะปััะตะฝะธะต ะธ ะผะธะณัะฐัะธะธ SQLite
โ   โ   โโโ repositories/
โ   โ   โ   โโโ user_repo.py
โ   โ   โ   โโโ challenge_repo.py
โ   โ   โ   โโโ vote_repo.py
โ   โ   โ   โโโ saved_repo.py
โ   โ
โ   โโโ services/
โ   โ   โโโ challenge_factory.py  # ะณะตะฝะตัะฐัะพั ัะตะปะปะตะฝะดะถะตะน
โ   โ   โโโ rendering.py          # ัะพัะผะฐัะธัะพะฒะฐะฝะธะต ัะตะบััะฐ
โ   โ   โโโ teleutil.py           # ะฑะตะทะพะฟะฐัะฝัะน edit_message
โ   โ
โ   โโโ middlewares/
โ       โโโ ratelimit.py      # ะฐะฝัะธัะฟะฐะผ
โ
โโโ .env                      # ัะตะบัะตัั (BOT_TOKEN ะธ ะดั.)
โโโ README.md
โโโ database.db               # ะฐะฒัะพะผะฐัะพะผ ัะพะทะดะฐัััั ะฟัะธ ะฟะตัะฒะพะผ ะทะฐะฟััะบะต
```

---

## ๐๏ธ ะฃััะฐะฝะพะฒะบะฐ

### 1) ะะปะพะฝะธัะพะฒะฐะฝะธะต ะฟัะพะตะบัะฐ

```bash
git clone https://github.com/<your_repo>/challengeforge-bot.git
cd challengeforge-bot
```

### 2) ะกะพะทะดะฐัะผ ะฒะธัััะฐะปัะฝะพะต ะพะบััะถะตะฝะธะต

```bash
python -m venv .venv
.venv\Scripts\activate
```

### 3) ะฃััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะทะฐะฒะธัะธะผะพััะธ

```bash
pip install -r requirements.txt
```

---

## ๐ง ะะฐัััะพะนะบะฐ `.env`

ะกะพะทะดะฐะน ัะฐะนะป `.env` ััะดะพะผ ั `main.py`:

```
BOT_TOKEN=ัะฒะพะน_ัะพะบะตะฝ_ะฑะพัะฐ_ะพั_BotFather
DB_PATH=database.db
CALLBACK_SECRET=ะปัะฑะพะน_ัะปััะฐะนะฝัะน_ัะตะบัะตั_ะดะปั_HMAC
```

> **CALLBACK_SECRET** โ ะฝะต ะพะฑัะทะฐัะตะปะตะฝ, ะฝะพ ัะธะปัะฝะพ ะฟะพะฒััะฐะตั ะฑะตะทะพะฟะฐัะฝะพััั.

---

## โถ๏ธ ะะฐะฟััะบ

```bash
python app/main.py
```

---

## ๐ฌ ะะพัััะฟะฝัะต ะบะพะผะฐะฝะดั

| ะะพะผะฐะฝะดะฐ      | ะะฟะธัะฐะฝะธะต                                         |
| ------------ | ------------------------------------------------ |
| `/start`     | ัะตะณะธัััะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปั                         |
| `/help`      | ัะฟะธัะพะบ ะบะพะผะฐะฝะด                                    |
| `/challenge` | ะฒัะดะฐัั ัะปััะฐะนะฝัะน ัะตะปะปะตะฝะดะถ                        |
| `/my`        | ะฒะฐัะธ ัะพััะฐะฝัะฝะฝัะต ัะตะปะปะตะฝะดะถะธ (ั ะฟะฐะณะธะฝะฐัะธะตะน)        |
| `/top`       | ะณะปะพะฑะฐะปัะฝัะน ัะพะฟ ัะตะปะปะตะฝะดะถะตะน                        |
| `/cancel`    | ะพัะผะตะฝะฐ ะดะตะนััะฒะธั (ะฝะฐะฟัะธะผะตั, ะพัะผะตะฝะฐ ะฒะฒะพะดะฐ ะทะฐะผะตัะบะธ) |

---

## ๐งฉ ะะฝะปะฐะนะฝ-ัะตะถะธะผ

ะะพั ะฟะพะดะดะตัะถะธะฒะฐะตั inline:

* ะะฒะตะดะธัะต ะฒ ะปัะฑะพะผ ัะฐัะต:

  ```
  @username_bot cid:123
  ```
* ะะปะธ ะฝะฐะถะผะธัะต ะบะฝะพะฟะบั **๐ค ะะพะดะตะปะธัััั** ะฟะพะด ะบะฐััะพัะบะพะน

ะ ัะตะทัะปััะฐัะต โ ะฑะพั ะพัะดะฐัั ะบะฐััะพัะบั ัะตะปะปะตะฝะดะถะฐ ั ะณะพะปะพัะพะฒะฐะฝะธะตะผ.

ะะพะปะพัะฐ **ะณะปะพะฑะฐะปัะฝั** โ ัะตะนัะธะฝะณ ะพะฑัะธะน.

---

## ๐ ะะฐะบ ัะฐะฑะพัะฐะตั ะณะพะปะพัะพะฒะฐะฝะธะต

* ะะพะปัะทะพะฒะฐัะตะปั ะผะพะถะตั ััะฐะฒะธัั ๐ ะธะปะธ ๐
* ะัะปะธ ะถะผัั ัั ะถะต ะบะฝะพะฟะบั ะฟะพะฒัะพัะฝะพ โ ะณะพะปะพั ัะฝะธะผะฐะตััั
* ะะตะนัะธะฝะณ ะพะฑะฝะพะฒะปัะตััั ัะตัะตะท ะฑะตะทะพะฟะฐัะฝัะน `edit_message` ะดะฐะถะต ะฒ inline-ัะพะพะฑัะตะฝะธัั

---

## ๐๏ธ ะะฐะทะฐ ะดะฐะฝะฝัั

SQLite ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะพะทะดะฐัั ัะฐะฑะปะธัั:

* `users` โ ะฟะพะปัะทะพะฒะฐัะตะปะธ
* `challenges` โ ัะตะปะปะตะฝะดะถะธ
* `votes` โ ะณะพะปะพัะฐ
* `saved` โ ัะพััะฐะฝัะฝะฝัะต ัะตะปะปะตะฝะดะถะธ + ะทะฐะผะตัะบะธ

---

## ๐ ะะตะทะพะฟะฐัะฝะพััั

* ะะธะฝะธ-ะฟัะพัะพะบะพะป `callback_data`:

  ```
  cf:1:<type>:<...>[:sig]
  ```
* ะะพะดะดะตัะถะบะฐ ะฒะตััะธะธ (`1`)
* HMAC-ะฟะพะดะฟะธัั ะดะฐะฝะฝัั (`sig`)
* ะะฐะปะธะดะฐัะธั ัะพัะผะฐัะฐ ัะตะณัะปััะบะฐะผะธ
* Rate-limit ะดะปั ัะพะพะฑัะตะฝะธะน ะธ callback-ะพะฒ

---

## โ๏ธ ะขะตัะฝะพะปะพะณะธะธ

* Python 3.13
* aiogram v3.7+
* aiosqlite
* FSMContext (aiogram)
* SQLite
* HMAC ะฟะพะดะฟะธัะธ

---

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต (ัะตะบะพะผะตะฝะดัะตััั)

* ะฎะฝะธั ัะตััั ัะตะฟะพะทะธัะพัะธะตะฒ
* ะขะตัั ะบะพะดะตะบะฐ `callback_data`
* ะะฝัะตะณัะฐัะธะพะฝะฝัะน ัะตัั:
  `/challenge โ ๐ โ ๐พ โ ะะฐ โ ัะตะบัั`.

---

## โ ะกัะฐััั ะฟัะพะตะบัะฐ

โ ะัะฝะพะฒะฝะพะน ััะฝะบัะธะพะฝะฐะป ัะฐะฑะพัะฐะตั
โ ะะพะปะพัะพะฒะฐะฝะธั ะณะปะพะฑะฐะปัะฝั
โ ะะฝะปะฐะนะฝ-ัะตะถะธะผ
โ ะะฐะณะธะฝะฐัะธั
โ FSM ะทะฐะผะตัะพะบ
โ ะะตะทะพะฟะฐัะฝัะต ะบะพะปะปะฑะตะบะธ

---
